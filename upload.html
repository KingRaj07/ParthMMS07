<script>
  function previewVideo() {
    const file = document.getElementById('videoFile').files[0];
    const preview = document.getElementById('videoPreview');
    const titleInput = document.getElementById('videoTitle');
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
      titleInput.value = file.name.replace(/\.[^/.]+$/, "");
    }
  }

  function submitUpload() {
    const file = document.getElementById('videoFile').files[0];
    const title = document.getElementById('videoTitle').value;
    const username = localStorage.getItem("username") || sessionStorage.getItem("username");

    if (!file || !title.trim()) {
      alert("Please select a video and enter a title.");
      return;
    }

    const formData = new FormData();
    formData.append('video', file);
    formData.append('title', title);
    formData.append('username', username || 'Unknown');

    fetch('upload.php', {
      method: 'POST',
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        alert("Uploaded successfully!");
        window.location.href = "dashboard.html";
      } else {
        alert("Upload failed: " + data.error);
      }
    })
    .catch(() => alert("An error occurred during upload."));
  }
</script>
